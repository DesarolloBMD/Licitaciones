<<<<<<< HEAD
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestión de Licitaciones — Registro</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    :root{
      --acento:#0B4912;
      --acento-2:#126a1a;
      --bg-hero: radial-gradient(1200px 600px at 10% -10%, #d9f99d55, transparent 40%),
                 radial-gradient(1000px 600px at 90% -20%, #34d39933, transparent 45%),
                 linear-gradient(180deg,#0b0f24 0%, #0b0f24 40%, #0e132c 100%);
    }
    body{ background:#0b0f24; color:#0e1b2a; }
    .hero{ background:var(--bg-hero); color:#eaf2ff; padding:48px 0 72px; position:relative; overflow:hidden; }
    .hero h1{ letter-spacing:.3px }
    .glass{ background:rgba(255,255,255,.9); backdrop-filter:blur(8px); border:1px solid rgba(255,255,255,.6); box-shadow:0 10px 30px rgba(0,0,0,.12); border-radius:18px; }
    .chip-group .btn-check:checked + .btn, .chip-group .btn:hover{ background:linear-gradient(90deg,var(--acento),var(--acento-2)); color:#fff; border-color:transparent; }
    .chip-group .btn{ border-radius:999px; border:1px solid #dfe6f1; color:#1d2a3a; background:#fff; padding:.45rem .85rem; }
    .section-title{ color:#11223b; }
    .divider{ height:1px; background:linear-gradient(90deg,transparent,#e7edf6,transparent); margin:.75rem 0 1.25rem; }
    .badge-soft{ background:#e8ffe8; color:#0b4912; border:1px solid #bde5bd; }
    .progress{ height:8px; }
    .floating-label .form-control,.floating-label .form-select{ padding-top:1.25rem; }
    .floating-label label{ font-size:.82rem; color:#5a6b85; }
    .btn-acento{ background:var(--acento); color:#fff; border:none; }
    .btn-acento:hover{ filter:brightness(1.05); color:#fff; }
    .summary h6{ color:#39506d; }
    .summary .kv{ display:flex; gap:.5rem; align-items:flex-start; }
    .summary .kv span:first-child{ min-width:9rem; color:#62758f; }
    @media (max-width: 991.98px){
      .actions-sticky{ position:sticky; bottom:0; background:#ffffffcc; backdrop-filter:blur(6px); border-top:1px solid #e9edf3; padding:.75rem; border-radius:0 0 18px 18px; }
    }
  </style>
</head>
<body>

  <!-- HERO -->
  <header class="hero">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
        <div class="d-flex align-items-center gap-3">
          <span class="d-inline-flex align-items-center justify-content-center bg-success rounded-3" style="width:48px;height:48px;box-shadow:0 8px 24px rgba(16,185,129,.25)">
            <i class="bi bi-journal-text text-white fs-4"></i>
          </span>
          <div>
            <h1 class="h3 m-0">Registro de Licitación</h1>
            <div class="text-white-50 small">Complete la información inicial para crear el expediente</div>
          </div>
        </div>
        <span class="badge badge-soft rounded-pill px-3 py-2">
          <i class="bi bi-shield-lock me-2"></i>Sesión segura
        </span>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container" style="margin-top:-42px; margin-bottom:64px;">
    <div class="glass p-3 p-lg-4">
      <div class="row g-4">
        <!-- FORMULARIO -->
        <div class="col-12 col-lg-8">
          <form id="form-lic" class="needs-validation" novalidate>
            <!-- Progreso -->
            <div class="mb-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <strong class="text-uppercase small text-muted">Completitud</strong>
                <span class="small" id="pctLabel">0%</span>
              </div>
              <div class="progress">
                <div class="progress-bar bg-success" id="pctBar" role="progressbar" style="width:0%"></div>
              </div>
            </div>

            <!-- Datos base -->
            <h2 class="section-title h5 d-flex align-items-center gap-2"><i class="bi bi-clipboard2-check text-success"></i> Datos base</h2>
            <div class="divider"></div>

            <div class="row g-3">
              <div class="col-6 col-md-3 floating-label">
                <label class="form-label">Año*</label>
                <select name="anio" class="form-select" required>
                  <option value="">Seleccionar…</option>
                  <option>2024</option>
                  <option>2025</option>
                </select>
                <div class="invalid-feedback">Seleccione el año</div>
              </div>

              <div class="col-6 col-md-3 floating-label">
                <label class="form-label">Mes*</label>
                <select name="mes" class="form-select" required>
                  <option value="">Seleccionar…</option>
                  <option value="1">enero</option><option value="2">febrero</option>
                  <option value="3">marzo</option><option value="4">abril</option>
                  <option value="5">mayo</option><option value="6">junio</option>
                  <option value="7">julio</option><option value="8">agosto</option>
                  <option value="9">septiembre</option><option value="10">octubre</option>
                  <option value="11">noviembre</option><option value="12">diciembre</option>
                </select>
                <div class="invalid-feedback">Seleccione el mes</div>
              </div>

              <div class="col-12 col-md-3 floating-label">
                <label class="form-label">Fecha presentación*</label>
                <input type="date" name="fecha_presentacion" class="form-control" required />
                <div class="invalid-feedback">Ingrese la fecha de presentación</div>
              </div>

              <div class="col-12 col-md-3 floating-label">
                <label class="form-label">Fecha de cierre*</label>
                <input type="date" name="fecha_cierre" class="form-control" required />
                <div class="invalid-feedback">Ingrese la fecha de cierre</div>
              </div>

              <div class="col-12 col-md-3 floating-label">
                <label class="form-label">Fecha (opcional)</label>
                <input type="date" name="fecha" class="form-control" />
              </div>

              <div class="col-12 col-md-5 floating-label">
                <label class="form-label">Número de Licitación*</label>
                <input type="text" name="numero_licitacion" class="form-control" required placeholder="Ejem. 2024-AB-12345" />
                <div class="invalid-feedback">Indique el número de licitación</div>
              </div>

              <div class="col-12 col-md-7 floating-label">
                <label class="form-label">Empresa Solicitante*</label>
                <input type="text" name="empresa_solicitante" class="form-control" required />
                <div class="invalid-feedback">Indique la empresa solicitante</div>
              </div>

              <div class="col-12 floating-label">
                <label class="form-label">Descripción*</label>
                <textarea name="descripcion" class="form-control" rows="3" required placeholder="Resumen del requerimiento, alcance, entregables..."></textarea>
                <div class="invalid-feedback">Ingrese la descripción</div>
              </div>
            </div>

            <!-- Presupuesto y encargado -->
            <h2 class="section-title h5 d-flex align-items-center gap-2 mt-4"><i class="bi bi-cash-coin text-success"></i> Presupuesto y encargado</h2>
            <div class="divider"></div>

            <div class="row g-3">
              <div class="col-12 col-md-3">
                <label class="form-label">Presupuesto SICOP</label>
                <div class="input-group">
                  <span class="input-group-text">₡</span>
                  <input type="number" name="presupuesto_sicop" class="form-control" step="0.01" min="0" placeholder="0.00" />
                </div>
              </div>
              <div class="col-12 col-md-3">
                <label class="form-label">Presupuesto BMD</label>
                <div class="input-group">
                  <span class="input-group-text">₡</span>
                  <input type="number" name="presupuesto_bmd" class="form-control" step="0.01" min="0" placeholder="0.00" />
                </div>
              </div>

              <!-- Encargado -->
              <div class="col-12 col-md-6">
                <label class="form-label d-block">Encargado*</label>
                <div class="chip-group btn-group" role="group" aria-label="Encargado">
                  <input class="btn-check" type="radio" name="encargado" id="enc1" value="Equipo Consultoría BMD" required>
                  <label class="btn" for="enc1"><i class="bi bi-people me-1"></i> Equipo Consultoría BMD</label>

                  <input class="btn-check" type="radio" name="encargado" id="enc2" value="Equipo Impresión BMD">
                  <label class="btn" for="enc2"><i class="bi bi-printer me-1"></i> Equipo Impresión BMD</label>
                </div>
                <div class="form-text">Selecciona el equipo responsable</div>
              </div>
            </div>

            <!-- Estado -->
            <h2 class="section-title h5 d-flex align-items-center gap-2 mt-4"><i class="bi bi-flag text-success"></i> Estado del proceso</h2>
            <div class="divider"></div>

            <div class="row g-3">
              <div class="col-12 col-lg-4">
                <label class="form-label d-block">Estado*</label>
                <div class="chip-group btn-group" role="group">
                  <input class="btn-check" type="radio" name="estado" id="estado1" value="en proceso" required>
                  <label class="btn" for="estado1"><i class="bi bi-hourglass-split me-1"></i> en proceso</label>

                  <input class="btn-check" type="radio" name="estado" id="estado2" value="finalizada">
                  <label class="btn" for="estado2"><i class="bi bi-clipboard-check me-1"></i> finalizada</label>
                </div>
                <div class="form-text">Seleccione el estado actual</div>
              </div>

              <div class="col-12 col-lg-4">
                <label class="form-label d-block">Respuesta*</label>
                <div class="chip-group btn-group" role="group">
                  <input class="btn-check" type="radio" name="respuesta" id="resp1" value="pendiente" required>
                  <label class="btn" for="resp1"><i class="bi bi-envelope-open me-1"></i> pendiente</label>

                  <input class="btn-check" type="radio" name="respuesta" id="resp2" value="perdida">
                  <label class="btn" for="resp2"><i class="bi bi-x-octagon me-1"></i> perdida</label>

                  <input class="btn-check" type="radio" name="respuesta" id="resp3" value="ganada">
                  <label class="btn" for="resp3"><i class="bi bi-trophy me-1"></i> ganada</label>
                </div>
              </div>

              <div class="col-12 col-lg-4">
                <label class="form-label d-block">Tipo*</label>
                <div class="chip-group btn-group" role="group">
                  <input class="btn-check" type="radio" name="tipo" id="tipo1" value="cantidad definida" required>
                  <label class="btn" for="tipo1"><i class="bi bi-123 me-1"></i> cantidad definida</label>

                  <input class="btn-check" type="radio" name="tipo" id="tipo2" value="demanda">
                  <label class="btn" for="tipo2"><i class="bi bi-infinity me-1"></i> demanda</label>
                </div>
              </div>
            </div>

            <!-- Observaciones -->
            <h2 class="section-title h5 d-flex align-items-center gap-2 mt-4"><i class="bi bi-chat-left-text text-success"></i> Observaciones</h2>
            <div class="divider"></div>

            <div class="row g-3">
              <div class="col-12">
                <label class="form-label">Observaciones Iniciales</label>
                <textarea name="observaciones_iniciales" class="form-control" rows="3"></textarea>
              </div>
            </div>

            <!-- Acciones -->
            <div class="actions-sticky mt-4 d-flex flex-wrap gap-2">
              <button class="btn btn-acento px-4" type="submit"><i class="bi bi-check2-circle me-1"></i> Guardar</button>
              <button class="btn btn-outline-secondary px-4" type="reset"><i class="bi bi-eraser me-1"></i> Limpiar</button>
              <div id="msg" class="ms-auto small text-muted"></div>
            </div>
          </form>
        </div>

        <!-- RESUMEN -->
        <div class="col-12 col-lg-4">
          <div class="p-3 p-lg-4 border rounded-4 bg-white h-100">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <h5 class="m-0 d-flex align-items-center gap-2"><i class="bi bi-eye"></i> Resumen</h5>
              <span class="badge text-bg-light border"><i class="bi bi-clock-history me-1"></i><span id="previewFecha">—</span></span>
            </div>
            <div class="summary small">
              <div class="kv"><span>Nº Licitación:</span> <strong id="pv-num">—</strong></div>
              <div class="kv"><span>Empresa:</span> <span id="pv-emp">—</span></div>
              <div class="kv"><span>Periodo:</span> <span><span id="pv-mes">—</span> / <span id="pv-ano">—</span></span></div>
              <div class="kv"><span>Presentación:</span> <span id="pv-fp">—</span></div>
              <div class="kv"><span>Cierre:</span> <span id="pv-fc">—</span></div>
              <div class="kv"><span>Encargado:</span> <span id="pv-enc">—</span></div>
              <div class="kv"><span>Estado:</span> <span id="pv-est">—</span></div>
              <div class="kv"><span>Respuesta:</span> <span id="pv-res">—</span></div>
              <div class="kv"><span>Tipo:</span> <span id="pv-tip">—</span></div>
              <div class="divider"></div>
              <h6>Presupuestos</h6>
              <div class="kv"><span>SICOP:</span> <span id="pv-ps">—</span></div>
              <div class="kv"><span>BMD:</span> <span id="pv-pb">—</span></div>
              <div class="divider"></div>
              <h6>Observaciones</h6>
              <div class="kv"><span>Iniciales:</span> <span id="pv-oi">—</span></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ========================
    // CONFIG API (auto-switch)
    // ========================
    const RENDER_API = 'https://licitaciones-5kie.onrender.com/'; // ✅ tu URL pública
    const usingGithub = location.hostname.endsWith('github.io') || location.protocol === 'file:';
    const API_BASE = usingGithub ? RENDER_API : ''; // GitHub/file -> Render; mismo servicio -> relativo

    const f  = document.getElementById('form-lic');
    const msg= document.getElementById('msg');

    // Validación Bootstrap
    (()=>{
      f.addEventListener('submit', e=>{
        if(!f.checkValidity()){
          e.preventDefault(); e.stopPropagation();
        }
        f.classList.add('was-validated');
      }, false);
    })();

    // Envío con verificación de Content-Type
    f.addEventListener('submit', async(e)=>{
      e.preventDefault();
      if(!f.checkValidity()) return;
      msg.textContent = 'Guardando…';
      try{
        const r = await fetch(API_BASE + 'licitacion_insertar.php', { method:'POST', body: new FormData(f) });
        const ct = (r.headers.get('content-type') || '').toLowerCase();
        const data = ct.includes('application/json') ? await r.json() : { ok:false, error: await r.text(), status: r.status };
        if(!r.ok || !data.ok) throw new Error(data.error || `HTTP ${r.status}`);
        msg.textContent = '¡Guardado! ID ' + (data.id ?? '');
        f.reset(); document.querySelectorAll('#form-lic .btn-check').forEach(b=>b.checked=false);
        document.getElementById('pctBar').style.width = '0%';
        document.getElementById('pctLabel').textContent = '0%';
        updatePreview();
      }catch(err){
        msg.textContent = '⚠ ' + err.message;
      }
    });

    // Progreso
    const requiredNames = ['anio','mes','fecha_presentacion','fecha_cierre','numero_licitacion','empresa_solicitante','descripcion','encargado','estado','respuesta','tipo'];
    function updateProgress(){
      let filled = 0;
      requiredNames.forEach(n=>{
        const els = f.querySelectorAll(`[name="${n}"]`);
        let ok=false;
        els.forEach(el=>{
          if(el.type==='radio'){ if(el.checked) ok=true; }
          else if(el.value && el.value.trim()!=='') ok=true;
        });
        if(ok) filled++;
      });
      const pct = Math.round((filled / requiredNames.length) * 100);
      document.getElementById('pctBar').style.width = pct + '%';
      document.getElementById('pctLabel').textContent = pct + '%';
    }
    f.addEventListener('input', updateProgress);
    f.addEventListener('change', updateProgress);

    // Resumen
    const $ = s => document.querySelector(s);
    function fmtMoney(v){ if(!v) return '—'; const n = Number(v); return isNaN(n)? '—' : '₡ ' + n.toLocaleString('es-CR',{minimumFractionDigits:2, maximumFractionDigits:2}); }
    function fmtDate(v){ return v? new Date(v+'T00:00:00').toLocaleDateString('es-CR') : '—'; }
    function getRadio(name){ const x = f.querySelector(`[name="${name}"]:checked`); return x? x.value : '—'; }

    function updatePreview(){
      $('#previewFecha').textContent = new Date().toLocaleString('es-CR',{dateStyle:'medium', timeStyle:'short'});
      $('#pv-num').textContent = f.numero_licitacion.value || '—';
      $('#pv-emp').textContent = f.empresa_solicitante.value || '—';
      $('#pv-ano').textContent = f.anio.value || '—';
      const mesSel = f.mes.options[f.mes.selectedIndex]?.text || '—';
      $('#pv-mes').textContent = mesSel;
      $('#pv-fp').textContent  = fmtDate(f.fecha_presentacion.value);
      $('#pv-fc').textContent  = fmtDate(f.fecha_cierre.value);
      $('#pv-enc').textContent = getRadio('encargado');
      $('#pv-est').textContent = getRadio('estado');
      $('#pv-res').textContent = getRadio('respuesta');
      $('#pv-tip').textContent = getRadio('tipo');
      $('#pv-ps').textContent  = fmtMoney(f.presupuesto_sicop.value);
      $('#pv-pb').textContent  = fmtMoney(f.presupuesto_bmd.value);
      $('#pv-oi').textContent  = f.observaciones_iniciales.value || '—';
    }
    f.addEventListener('input', updatePreview);
    f.addEventListener('change', updatePreview);
    updatePreview();
  </script>
</body>
</html>
=======
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestión de Licitaciones — Registro</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    :root{
      --acento:#0B4912;
      --acento-2:#126a1a;
      --bg-hero: radial-gradient(1200px 600px at 10% -10%, #d9f99d55, transparent 40%),
                 radial-gradient(1000px 600px at 90% -20%, #34d39933, transparent 45%),
                 linear-gradient(180deg,#0b0f24 0%, #0b0f24 40%, #0e132c 100%);
    }
    body{ background:#0b0f24; color:#0e1b2a; }
    .hero{ background:var(--bg-hero); color:#eaf2ff; padding:48px 0 72px; position:relative; overflow:hidden; }
    .hero h1{ letter-spacing:.3px }
    .glass{ background:rgba(255,255,255,.9); backdrop-filter:blur(8px); border:1px solid rgba(255,255,255,.6); box-shadow:0 10px 30px rgba(0,0,0,.12); border-radius:18px; }
    .chip-group .btn-check:checked + .btn, .chip-group .btn:hover{ background:linear-gradient(90deg,var(--acento),var(--acento-2)); color:#fff; border-color:transparent; }
    .chip-group .btn{ border-radius:999px; border:1px solid #dfe6f1; color:#1d2a3a; background:#fff; padding:.45rem .85rem; }
    .section-title{ color:#11223b; }
    .divider{ height:1px; background:linear-gradient(90deg,transparent,#e7edf6,transparent); margin:.75rem 0 1.25rem; }
    .badge-soft{ background:#e8ffe8; color:#0b4912; border:1px solid #bde5bd; }
    .progress{ height:8px; }
    .floating-label .form-control,.floating-label .form-select{ padding-top:1.25rem; }
    .floating-label label{ font-size:.82rem; color:#5a6b85; }
    .btn-acento{ background:var(--acento); color:#fff; border:none; }
    .btn-acento:hover{ filter:brightness(1.05); color:#fff; }
    .summary h6{ color:#39506d; }
    .summary .kv{ display:flex; gap:.5rem; align-items:flex-start; }
    .summary .kv span:first-child{ min-width:9rem; color:#62758f; }
    @media (max-width: 991.98px){
      .actions-sticky{ position:sticky; bottom:0; background:#ffffffcc; backdrop-filter:blur(6px); border-top:1px solid #e9edf3; padding:.75rem; border-radius:0 0 18px 18px; }
    }
  </style>
</head>
<body>

  <!-- HERO -->
  <header class="hero">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
        <div class="d-flex align-items-center gap-3">
          <span class="d-inline-flex align-items-center justify-content-center bg-success rounded-3" style="width:48px;height:48px;box-shadow:0 8px 24px rgba(16,185,129,.25)">
            <i class="bi bi-journal-text text-white fs-4"></i>
          </span>
          <div>
            <h1 class="h3 m-0">Registro de Licitación</h1>
            <div class="text-white-50 small">Complete la información inicial para crear el expediente</div>
          </div>
        </div>
        <span class="badge badge-soft rounded-pill px-3 py-2">
          <i class="bi bi-shield-lock me-2"></i>Sesión segura
        </span>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container" style="margin-top:-42px; margin-bottom:64px;">
    <div class="glass p-3 p-lg-4">
      <div class="row g-4">
        <!-- FORMULARIO -->
        <div class="col-12 col-lg-8">
          <form id="form-lic" class="needs-validation" novalidate>
            <!-- Progreso -->
            <div class="mb-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <strong class="text-uppercase small text-muted">Completitud</strong>
                <span class="small" id="pctLabel">0%</span>
              </div>
              <div class="progress">
                <div class="progress-bar bg-success" id="pctBar" role="progressbar" style="width:0%"></div>
              </div>
            </div>

            <!-- Datos base -->
            <h2 class="section-title h5 d-flex align-items-center gap-2"><i class="bi bi-clipboard2-check text-success"></i> Datos base</h2>
            <div class="divider"></div>

            <div class="row g-3">
              <div class="col-6 col-md-3 floating-label">
                <label class="form-label">Año*</label>
                <select name="anio" class="form-select" required>
                  <option value="">Seleccionar…</option>
                  <option>2024</option>
                  <option>2025</option>
                </select>
                <div class="invalid-feedback">Seleccione el año</div>
              </div>

              <div class="col-6 col-md-3 floating-label">
                <label class="form-label">Mes*</label>
                <select name="mes" class="form-select" required>
                  <option value="">Seleccionar…</option>
                  <option value="1">enero</option><option value="2">febrero</option>
                  <option value="3">marzo</option><option value="4">abril</option>
                  <option value="5">mayo</option><option value="6">junio</option>
                  <option value="7">julio</option><option value="8">agosto</option>
                  <option value="9">septiembre</option><option value="10">octubre</option>
                  <option value="11">noviembre</option><option value="12">diciembre</option>
                </select>
                <div class="invalid-feedback">Seleccione el mes</div>
              </div>

              <div class="col-12 col-md-3 floating-label">
                <label class="form-label">Fecha presentación*</label>
                <input type="date" name="fecha_presentacion" class="form-control" required />
                <div class="invalid-feedback">Ingrese la fecha de presentación</div>
              </div>

              <div class="col-12 col-md-3 floating-label">
                <label class="form-label">Fecha de cierre*</label>
                <input type="date" name="fecha_cierre" class="form-control" required />
                <div class="invalid-feedback">Ingrese la fecha de cierre</div>
              </div>

              <div class="col-12 col-md-3 floating-label">
                <label class="form-label">Fecha (opcional)</label>
                <input type="date" name="fecha" class="form-control" />
              </div>

              <div class="col-12 col-md-5 floating-label">
                <label class="form-label">Número de Licitación*</label>
                <input type="text" name="numero_licitacion" class="form-control" required placeholder="Ejem. 2024-AB-12345" />
                <div class="invalid-feedback">Indique el número de licitación</div>
              </div>

              <div class="col-12 col-md-7 floating-label">
                <label class="form-label">Empresa Solicitante*</label>
                <input type="text" name="empresa_solicitante" class="form-control" required />
                <div class="invalid-feedback">Indique la empresa solicitante</div>
              </div>

              <div class="col-12 floating-label">
                <label class="form-label">Descripción*</label>
                <textarea name="descripcion" class="form-control" rows="3" required placeholder="Resumen del requerimiento, alcance, entregables..."></textarea>
                <div class="invalid-feedback">Ingrese la descripción</div>
              </div>
            </div>

            <!-- Presupuesto y encargado -->
            <h2 class="section-title h5 d-flex align-items-center gap-2 mt-4"><i class="bi bi-cash-coin text-success"></i> Presupuesto y encargado</h2>
            <div class="divider"></div>

            <div class="row g-3">
              <div class="col-12 col-md-3">
                <label class="form-label">Presupuesto SICOP</label>
                <div class="input-group">
                  <span class="input-group-text">₡</span>
                  <input type="number" name="presupuesto_sicop" class="form-control" step="0.01" min="0" placeholder="0.00" />
                </div>
              </div>
              <div class="col-12 col-md-3">
                <label class="form-label">Presupuesto BMD</label>
                <div class="input-group">
                  <span class="input-group-text">₡</span>
                  <input type="number" name="presupuesto_bmd" class="form-control" step="0.01" min="0" placeholder="0.00" />
                </div>
              </div>

              <!-- Encargado -->
              <div class="col-12 col-md-6">
                <label class="form-label d-block">Encargado*</label>
                <div class="chip-group btn-group" role="group" aria-label="Encargado">
                  <input class="btn-check" type="radio" name="encargado" id="enc1" value="Equipo Consultoría BMD" required>
                  <label class="btn" for="enc1"><i class="bi bi-people me-1"></i> Equipo Consultoría BMD</label>

                  <input class="btn-check" type="radio" name="encargado" id="enc2" value="Equipo Impresión BMD">
                  <label class="btn" for="enc2"><i class="bi bi-printer me-1"></i> Equipo Impresión BMD</label>
                </div>
                <div class="form-text">Selecciona el equipo responsable</div>
              </div>
            </div>

            <!-- Estado -->
            <h2 class="section-title h5 d-flex align-items-center gap-2 mt-4"><i class="bi bi-flag text-success"></i> Estado del proceso</h2>
            <div class="divider"></div>

            <div class="row g-3">
              <div class="col-12 col-lg-4">
                <label class="form-label d-block">Estado*</label>
                <div class="chip-group btn-group" role="group">
                  <input class="btn-check" type="radio" name="estado" id="estado1" value="en proceso" required>
                  <label class="btn" for="estado1"><i class="bi bi-hourglass-split me-1"></i> en proceso</label>

                  <input class="btn-check" type="radio" name="estado" id="estado2" value="finalizada">
                  <label class="btn" for="estado2"><i class="bi bi-clipboard-check me-1"></i> finalizada</label>
                </div>
                <div class="form-text">Seleccione el estado actual</div>
              </div>

              <div class="col-12 col-lg-4">
                <label class="form-label d-block">Respuesta*</label>
                <div class="chip-group btn-group" role="group">
                  <input class="btn-check" type="radio" name="respuesta" id="resp1" value="pendiente" required>
                  <label class="btn" for="resp1"><i class="bi bi-envelope-open me-1"></i> pendiente</label>

                  <input class="btn-check" type="radio" name="respuesta" id="resp2" value="perdida">
                  <label class="btn" for="resp2"><i class="bi bi-x-octagon me-1"></i> perdida</label>

                  <input class="btn-check" type="radio" name="respuesta" id="resp3" value="ganada">
                  <label class="btn" for="resp3"><i class="bi bi-trophy me-1"></i> ganada</label>
                </div>
              </div>

              <div class="col-12 col-lg-4">
                <label class="form-label d-block">Tipo*</label>
                <div class="chip-group btn-group" role="group">
                  <input class="btn-check" type="radio" name="tipo" id="tipo1" value="cantidad definida" required>
                  <label class="btn" for="tipo1"><i class="bi bi-123 me-1"></i> cantidad definida</label>

                  <input class="btn-check" type="radio" name="tipo" id="tipo2" value="demanda">
                  <label class="btn" for="tipo2"><i class="bi bi-infinity me-1"></i> demanda</label>
                </div>
              </div>
            </div>

            <!-- Observaciones -->
            <h2 class="section-title h5 d-flex align-items-center gap-2 mt-4"><i class="bi bi-chat-left-text text-success"></i> Observaciones</h2>
            <div class="divider"></div>

            <div class="row g-3">
              <div class="col-12">
                <label class="form-label">Observaciones Iniciales</label>
                <textarea name="observaciones_iniciales" class="form-control" rows="3"></textarea>
              </div>
            </div>

            <!-- Acciones -->
            <div class="actions-sticky mt-4 d-flex flex-wrap gap-2">
              <button class="btn btn-acento px-4" type="submit"><i class="bi bi-check2-circle me-1"></i> Guardar</button>
              <button class="btn btn-outline-secondary px-4" type="reset"><i class="bi bi-eraser me-1"></i> Limpiar</button>
              <div id="msg" class="ms-auto small text-muted"></div>
            </div>
          </form>
        </div>

        <!-- RESUMEN -->
        <div class="col-12 col-lg-4">
          <div class="p-3 p-lg-4 border rounded-4 bg-white h-100">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <h5 class="m-0 d-flex align-items-center gap-2"><i class="bi bi-eye"></i> Resumen</h5>
              <span class="badge text-bg-light border"><i class="bi bi-clock-history me-1"></i><span id="previewFecha">—</span></span>
            </div>
            <div class="summary small">
              <div class="kv"><span>Nº Licitación:</span> <strong id="pv-num">—</strong></div>
              <div class="kv"><span>Empresa:</span> <span id="pv-emp">—</span></div>
              <div class="kv"><span>Periodo:</span> <span><span id="pv-mes">—</span> / <span id="pv-ano">—</span></span></div>
              <div class="kv"><span>Presentación:</span> <span id="pv-fp">—</span></div>
              <div class="kv"><span>Cierre:</span> <span id="pv-fc">—</span></div>
              <div class="kv"><span>Encargado:</span> <span id="pv-enc">—</span></div>
              <div class="kv"><span>Estado:</span> <span id="pv-est">—</span></div>
              <div class="kv"><span>Respuesta:</span> <span id="pv-res">—</span></div>
              <div class="kv"><span>Tipo:</span> <span id="pv-tip">—</span></div>
              <div class="divider"></div>
              <h6>Presupuestos</h6>
              <div class="kv"><span>SICOP:</span> <span id="pv-ps">—</span></div>
              <div class="kv"><span>BMD:</span> <span id="pv-pb">—</span></div>
              <div class="divider"></div>
              <h6>Observaciones</h6>
              <div class="kv"><span>Iniciales:</span> <span id="pv-oi">—</span></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ========================
    // CONFIG API (auto-switch)
    // ========================
    const RENDER_API = 'https://licitaciones-5kie.onrender.com/'; // ✅ tu URL pública
    const usingGithub = location.hostname.endsWith('github.io') || location.protocol === 'file:';
    const API_BASE = usingGithub ? RENDER_API : ''; // GitHub/file -> Render; mismo servicio -> relativo

    const f  = document.getElementById('form-lic');
    const msg= document.getElementById('msg');

    // Validación Bootstrap
    (()=>{
      f.addEventListener('submit', e=>{
        if(!f.checkValidity()){
          e.preventDefault(); e.stopPropagation();
        }
        f.classList.add('was-validated');
      }, false);
    })();

    // Envío con verificación de Content-Type
    f.addEventListener('submit', async(e)=>{
      e.preventDefault();
      if(!f.checkValidity()) return;
      msg.textContent = 'Guardando…';
      try{
        const r = await fetch(API_BASE + 'licitacion_insertar.php', { method:'POST', body: new FormData(f) });
        const ct = (r.headers.get('content-type') || '').toLowerCase();
        const data = ct.includes('application/json') ? await r.json() : { ok:false, error: await r.text(), status: r.status };
        if(!r.ok || !data.ok) throw new Error(data.error || `HTTP ${r.status}`);
        msg.textContent = '¡Guardado! ID ' + (data.id ?? '');
        f.reset(); document.querySelectorAll('#form-lic .btn-check').forEach(b=>b.checked=false);
        document.getElementById('pctBar').style.width = '0%';
        document.getElementById('pctLabel').textContent = '0%';
        updatePreview();
      }catch(err){
        msg.textContent = '⚠ ' + err.message;
      }
    });

    // Progreso
    const requiredNames = ['anio','mes','fecha_presentacion','fecha_cierre','numero_licitacion','empresa_solicitante','descripcion','encargado','estado','respuesta','tipo'];
    function updateProgress(){
      let filled = 0;
      requiredNames.forEach(n=>{
        const els = f.querySelectorAll(`[name="${n}"]`);
        let ok=false;
        els.forEach(el=>{
          if(el.type==='radio'){ if(el.checked) ok=true; }
          else if(el.value && el.value.trim()!=='') ok=true;
        });
        if(ok) filled++;
      });
      const pct = Math.round((filled / requiredNames.length) * 100);
      document.getElementById('pctBar').style.width = pct + '%';
      document.getElementById('pctLabel').textContent = pct + '%';
    }
    f.addEventListener('input', updateProgress);
    f.addEventListener('change', updateProgress);

    // Resumen
    const $ = s => document.querySelector(s);
    function fmtMoney(v){ if(!v) return '—'; const n = Number(v); return isNaN(n)? '—' : '₡ ' + n.toLocaleString('es-CR',{minimumFractionDigits:2, maximumFractionDigits:2}); }
    function fmtDate(v){ return v? new Date(v+'T00:00:00').toLocaleDateString('es-CR') : '—'; }
    function getRadio(name){ const x = f.querySelector(`[name="${name}"]:checked`); return x? x.value : '—'; }

    function updatePreview(){
      $('#previewFecha').textContent = new Date().toLocaleString('es-CR',{dateStyle:'medium', timeStyle:'short'});
      $('#pv-num').textContent = f.numero_licitacion.value || '—';
      $('#pv-emp').textContent = f.empresa_solicitante.value || '—';
      $('#pv-ano').textContent = f.anio.value || '—';
      const mesSel = f.mes.options[f.mes.selectedIndex]?.text || '—';
      $('#pv-mes').textContent = mesSel;
      $('#pv-fp').textContent  = fmtDate(f.fecha_presentacion.value);
      $('#pv-fc').textContent  = fmtDate(f.fecha_cierre.value);
      $('#pv-enc').textContent = getRadio('encargado');
      $('#pv-est').textContent = getRadio('estado');
      $('#pv-res').textContent = getRadio('respuesta');
      $('#pv-tip').textContent = getRadio('tipo');
      $('#pv-ps').textContent  = fmtMoney(f.presupuesto_sicop.value);
      $('#pv-pb').textContent  = fmtMoney(f.presupuesto_bmd.value);
      $('#pv-oi').textContent  = f.observaciones_iniciales.value || '—';
    }
    f.addEventListener('input', updatePreview);
    f.addEventListener('change', updatePreview);
    updatePreview();
  </script>
</body>
</html>
>>>>>>> 216583a9ae240431046763ba1b8cc297173bf0b7
