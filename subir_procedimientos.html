<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Importador de Datos CSV / Excel</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    :root {
      --color-principal: #0B4912;
      --color-secundario: #126a1a;
    }
    body {
      background: #0b0f24;
      color: #eaf2ff;
      font-family: system-ui, sans-serif;
      padding: 40px 20px;
    }
    .panel {
      background: #ffffff;
      color: #0e1b2a;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,.15);
      padding: 24px;
      max-width: 800px;
      margin: 0 auto;
    }
    .btn-acento {
      background-color: var(--color-principal);
      color: #fff;
      font-weight: 600;
    }
    .btn-acento:hover {
      background-color: var(--color-secundario);
      color: #fff;
    }
    .progress {
      height: 10px;
      border-radius: 10px;
    }
    #cronometro {
      font-family: monospace;
      color: #555;
    }
  </style>
</head>
<body>

<div class="container">
  <h2 class="text-center mb-4">ðŸ“‚ Importador de Datos (.CSV / .XLSX)</h2>

  <div class="panel">
    <form id="formImportador" class="vstack gap-3">

      <!-- Selector de archivo -->
      <div>
        <label class="form-label fw-semibold">Seleccione archivo:</label>
        <input type="file" class="form-control" id="archivo" accept=".csv,.xlsx" required>
        <div class="form-text text-muted">Formatos permitidos: <code>.csv</code> o <code>.xlsx</code></div>
      </div>

      <!-- Checkbox de encabezados -->
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="tieneHeader" checked>
        <label class="form-check-label" for="tieneHeader">La primera fila contiene encabezados</label>
      </div>

      <!-- Botones -->
      <div class="d-flex flex-wrap gap-2">
        <button type="submit" class="btn btn-acento">
          <i class="bi bi-cloud-arrow-up me-1"></i> Importar
        </button>
        <button type="button" id="btnCancelar" class="btn btn-outline-danger" disabled>
          <i class="bi bi-x-circle me-1"></i> Cancelar
        </button>
        <button type="reset" id="btnLimpiar" class="btn btn-outline-secondary">
          <i class="bi bi-eraser me-1"></i> Limpiar
        </button>
      </div>

      <!-- Barra de progreso -->
      <div id="progresoArea" class="mt-3 d-none">
        <small class="text-muted">Progreso:</small>
        <div class="progress mt-1">
          <div class="progress-bar bg-success" id="barraProgreso" style="width:0%">0%</div>
        </div>
        <small class="text-muted">Tiempo transcurrido: <span id="cronometro">00:00</span></small>
      </div>

    </form>
  </div>
</div>

<!-- Bootstrap Icons y JS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

<script>
const form = document.getElementById('formImportador');
const archivo = document.getElementById('archivo');
const barra = document.getElementById('barraProgreso');
const progresoArea = document.getElementById('progresoArea');
const cronometro = document.getElementById('cronometro');
const btnCancelar = document.getElementById('btnCancelar');

let timer = null, startTime = 0, controller = null;

// Formato mm:ss
function formatTime(ms) {
  const s = Math.floor(ms / 1000);
  const m = String(Math.floor(s / 60)).padStart(2, '0');
  const sec = String(s % 60).padStart(2, '0');
  return `${m}:${sec}`;
}

function startTimer() {
  startTime = performance.now();
  cronometro.textContent = "00:00";
  timer = setInterval(() => {
    cronometro.textContent = formatTime(performance.now() - startTime);
  }, 500);
}

function stopTimer() {
  clearInterval(timer);
  timer = null;
}

// SimulaciÃ³n de progreso (solo visual)
function setProgress(pct) {
  progresoArea.classList.remove('d-none');
  barra.style.width = pct + '%';
  barra.textContent = pct + '%';
}

// Acciones
form.addEventListener('submit', (e) => {
  e.preventDefault();
  const file = archivo.files[0];
  if (!file) return alert('Seleccione un archivo antes de importar.');

  setProgress(0);
  startTimer();
  btnCancelar.disabled = false;

  let p = 0;
  controller = setInterval(() => {
    p += Math.random() * 10;
    if (p >= 100) {
      p = 100;
      clearInterval(controller);
      stopTimer();
      btnCancelar.disabled = true;
    }
    setProgress(Math.round(p));
  }, 400);
});

btnCancelar.addEventListener('click', () => {
  if (controller) clearInterval(controller);
  stopTimer();
  btnCancelar.disabled = true;
  barra.style.width = '0%';
  barra.textContent = '0%';
});

form.addEventListener('reset', () => {
  stopTimer();
  barra.style.width = '0%';
  barra.textContent = '0%';
  progresoArea.classList.add('d-none');
});
</script>

</body>
</html>
